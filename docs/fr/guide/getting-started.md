# D√©marrage rapide

Bienvenue sur YasuiJS ! Ce guide vous accompagnera dans la cr√©ation de votre premi√®re API depuis z√©ro. √Ä la fin, vous aurez une API REST enti√®rement fonctionnelle avec une structure appropri√©e et les meilleures pratiques.

## Ce que vous allez construire

Nous allons cr√©er une API simple de gestion d'utilisateurs qui d√©montre les fonctionnalit√©s principales de YasuiJS :
- Op√©rations CRUD utilisateur (Cr√©er, Lire, Mettre √† jour, Supprimer)
- Injection de d√©pendances avec des services
- Extraction et validation de param√®tres
- Gestion d'erreurs de base

## Pr√©requis

Avant de commencer, assurez-vous d'avoir :

- **Node.js** (version 16 ou sup√©rieure) - [T√©l√©charger ici](https://nodejs.org/)
- **npm** ou **yarn** comme gestionnaire de paquets
- Connaissances de base en **TypeScript** et **Express.js**

Vous pouvez v√©rifier votre version de Node.js avec :
```bash
node --version
```

## √âtape 1 : Configuration du projet

Commen√ßons par cr√©er un nouveau projet et installer les d√©pendances n√©cessaires.

### Cr√©er un nouveau r√©pertoire
```bash
mkdir mon-api-yasui
cd mon-api-yasui
```

### Initialiser le projet
```bash
npm init -y
```

### Installer les d√©pendances
```bash
npm install yasui express
npm install -D typescript @types/node ts-node nodemon
```

### Configuration TypeScript
Cr√©ez un fichier `tsconfig.json` :

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "experimentalDecorators": true,
    "emitDecoratorMetadata": true,
    "resolveJsonModule": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

### Scripts package.json
Mettez √† jour votre `package.json` pour inclure des scripts utiles :

```json
{
  "scripts": {
    "dev": "nodemon src/app.ts",
    "build": "tsc",
    "start": "node dist/app.js"
  }
}
```

## √âtape 2 : Cr√©er votre premier contr√¥leur

Les contr√¥leurs sont le c≈ìur de votre application YasuiJS. Ils g√®rent les requ√™tes HTTP entrantes et retournent les r√©ponses.

Cr√©ez le fichier `src/controllers/user.controller.ts` :

```typescript
import { Controller, Get, Post, Put, Delete, Body, Param, Query } from 'yasui';

// D√©finir nos types de donn√©es
interface User {
  id: string;
  name: string;
  email: string;
  createdAt: Date;
}

interface CreateUserDto {
  name: string;
  email: string;
}

interface UpdateUserDto {
  name?: string;
  email?: string;
}

@Controller('/api/users')
export class UserController {
  
  // Stockage en m√©moire pour cet exemple
  private users: User[] = [
    { 
      id: '1', 
      name: 'Jean Dupont', 
      email: 'jean@exemple.com',
      createdAt: new Date()
    },
    { 
      id: '2', 
      name: 'Marie Martin', 
      email: 'marie@exemple.com',
      createdAt: new Date()
    }
  ];

  // GET /api/users - Obtenir tous les utilisateurs avec pagination optionnelle
  @Get('/')
  getAllUsers(
    @Query('page') page: number = 1,
    @Query('limit') limit: number = 10
  ) {
    const startIndex = (page - 1) * limit;
    const endIndex = startIndex + limit;
    const paginatedUsers = this.users.slice(startIndex, endIndex);
    
    return {
      users: paginatedUsers,
      pagination: {
        page,
        limit,
        total: this.users.length,
        totalPages: Math.ceil(this.users.length / limit)
      }
    };
  }

  // GET /api/users/:id - Obtenir un utilisateur sp√©cifique
  @Get('/:id')
  getUser(@Param('id') id: string) {
    const user = this.users.find(user => user.id === id);
    
    if (!user) {
      throw new Error('Utilisateur non trouv√©');
    }
    
    return user;
  }

  // POST /api/users - Cr√©er un nouvel utilisateur
  @Post('/')
  createUser(@Body() userData: CreateUserDto) {
    const newUser: User = {
      id: Date.now().toString(),
      ...userData,
      createdAt: new Date()
    };
    
    this.users.push(newUser);
    return newUser;
  }

  // PUT /api/users/:id - Mettre √† jour un utilisateur
  @Put('/:id')
  updateUser(@Param('id') id: string, @Body() userData: UpdateUserDto) {
    const userIndex = this.users.findIndex(user => user.id === id);
    
    if (userIndex === -1) {
      throw new Error('Utilisateur non trouv√©');
    }
    
    this.users[userIndex] = {
      ...this.users[userIndex],
      ...userData
    };
    
    return this.users[userIndex];
  }

  // DELETE /api/users/:id - Supprimer un utilisateur
  @Delete('/:id')
  deleteUser(@Param('id') id: string) {
    const userIndex = this.users.findIndex(user => user.id === id);
    
    if (userIndex === -1) {
      throw new Error('Utilisateur non trouv√©');
    }
    
    const deletedUser = this.users[userIndex];
    this.users.splice(userIndex, 1);
    
    return { message: 'Utilisateur supprim√© avec succ√®s', user: deletedUser };
  }
}
```

## √âtape 3 : Cr√©er votre application

Maintenant, cr√©ons le fichier d'application principal qui lie tout ensemble.

Cr√©ez `src/app.ts` :

```typescript
import { YasuiApp } from 'yasui';
import { UserController } from './controllers/user.controller';

// Cr√©er l'application YasuiJS
const app = new YasuiApp({
  port: 3000,
  debug: true, // Activer le mode debug pour le d√©veloppement
  cors: true   // Activer CORS pour l'int√©gration frontend
});

// Enregistrer vos contr√¥leurs
app.registerControllers([UserController]);

// D√©marrer le serveur
app.start().then(() => {
  console.log('üöÄ L\'API YasuiJS fonctionne sur http://localhost:3000');
  console.log('üìö Documentation API disponible sur http://localhost:3000/api-docs');
});
```

## √âtape 4 : Ex√©cuter votre application

Maintenant, il est temps de voir votre API en action !

```bash
npm run dev
```

Vous devriez voir une sortie comme :
```
üöÄ L'API YasuiJS fonctionne sur http://localhost:3000
üìö Documentation API disponible sur http://localhost:3000/api-docs
```

## √âtape 5 : Tester votre API

Testons tous les endpoints que nous avons cr√©√©s. Vous pouvez utiliser curl, Postman ou n'importe quel client API.

### Obtenir tous les utilisateurs
```bash
curl http://localhost:3000/api/users
```

### Obtenir les utilisateurs avec pagination
```bash
curl "http://localhost:3000/api/users?page=1&limit=5"
```

### Obtenir un utilisateur sp√©cifique
```bash
curl http://localhost:3000/api/users/1
```

### Cr√©er un nouvel utilisateur
```bash
curl -X POST http://localhost:3000/api/users \
  -H "Content-Type: application/json" \
  -d '{"name": "Alice Dubois", "email": "alice@exemple.com"}'
```

### Mettre √† jour un utilisateur
```bash
curl -X PUT http://localhost:3000/api/users/1 \
  -H "Content-Type: application/json" \
  -d '{"name": "Jean Mis √† jour"}'
```

### Supprimer un utilisateur
```bash
curl -X DELETE http://localhost:3000/api/users/2
```

## √âtape 6 : Ajouter une couche service

Maintenant, am√©liorons notre code en ajoutant une couche service. Cela s√©pare la logique m√©tier du contr√¥leur.

Cr√©ez `src/services/user.service.ts` :

```typescript
import { Injectable } from 'yasui';

interface User {
  id: string;
  name: string;
  email: string;
  createdAt: Date;
}

interface CreateUserDto {
  name: string;
  email: string;
}

interface UpdateUserDto {
  name?: string;
  email?: string;
}

@Injectable()
export class UserService {
  private users: User[] = [
    { 
      id: '1', 
      name: 'Jean Dupont', 
      email: 'jean@exemple.com',
      createdAt: new Date()
    },
    { 
      id: '2', 
      name: 'Marie Martin', 
      email: 'marie@exemple.com',
      createdAt: new Date()
    }
  ];

  getAllUsers(page: number = 1, limit: number = 10) {
    const startIndex = (page - 1) * limit;
    const endIndex = startIndex + limit;
    const paginatedUsers = this.users.slice(startIndex, endIndex);
    
    return {
      users: paginatedUsers,
      pagination: {
        page,
        limit,
        total: this.users.length,
        totalPages: Math.ceil(this.users.length / limit)
      }
    };
  }

  getUserById(id: string): User | null {
    return this.users.find(user => user.id === id) || null;
  }

  createUser(userData: CreateUserDto): User {
    const newUser: User = {
      id: Date.now().toString(),
      ...userData,
      createdAt: new Date()
    };
    
    this.users.push(newUser);
    return newUser;
  }

  updateUser(id: string, userData: UpdateUserDto): User | null {
    const userIndex = this.users.findIndex(user => user.id === id);
    if (userIndex === -1) return null;
    
    this.users[userIndex] = { ...this.users[userIndex], ...userData };
    return this.users[userIndex];
  }

  deleteUser(id: string): User | null {
    const userIndex = this.users.findIndex(user => user.id === id);
    if (userIndex === -1) return null;
    
    const deletedUser = this.users[userIndex];
    this.users.splice(userIndex, 1);
    
    return deletedUser;
  }
}
```

Maintenant, mettez √† jour votre contr√¥leur pour utiliser le service :

```typescript
import { Controller, Get, Post, Put, Delete, Body, Param, Query } from 'yasui';
import { UserService } from '../services/user.service';

interface CreateUserDto {
  name: string;
  email: string;
}

interface UpdateUserDto {
  name?: string;
  email?: string;
}

@Controller('/api/users')
export class UserController {
  
  constructor(private userService: UserService) {}

  @Get('/')
  getAllUsers(
    @Query('page') page: number = 1,
    @Query('limit') limit: number = 10
  ) {
    return this.userService.getAllUsers(page, limit);
  }

  @Get('/:id')
  getUser(@Param('id') id: string) {
    const user = this.userService.getUserById(id);
    
    if (!user) {
      throw new Error('Utilisateur non trouv√©');
    }
    
    return user;
  }

  @Post('/')
  createUser(@Body() userData: CreateUserDto) {
    return this.userService.createUser(userData);
  }

  @Put('/:id')
  updateUser(@Param('id') id: string, @Body() userData: UpdateUserDto) {
    const updatedUser = this.userService.updateUser(id, userData);
    
    if (!updatedUser) {
      throw new Error('Utilisateur non trouv√©');
    }
    
    return updatedUser;
  }

  @Delete('/:id')
  deleteUser(@Param('id') id: string) {
    const deletedUser = this.userService.deleteUser(id);
    
    if (!deletedUser) {
      throw new Error('Utilisateur non trouv√©');
    }
    
    return { message: 'Utilisateur supprim√© avec succ√®s', user: deletedUser };
  }
}
```

## √âtape 7 : Ajouter un middleware de base

Ajoutons un middleware pour la journalisation et la validation de base.

Cr√©ez `src/middleware/logging.middleware.ts` :

```typescript
import { Request, Response, NextFunction } from 'express';

export function loggingMiddleware(req: Request, res: Response, next: NextFunction) {
  const start = Date.now();
  
  console.log(`${new Date().toISOString()} - ${req.method} ${req.path}`);
  
  res.on('finish', () => {
    const duration = Date.now() - start;
    console.log(`${new Date().toISOString()} - ${req.method} ${req.path} - ${res.statusCode} - ${duration}ms`);
  });
  
  next();
}
```

Mettez √† jour votre `src/app.ts` pour inclure le middleware :

```typescript
import { YasuiApp } from 'yasui';
import { UserController } from './controllers/user.controller';
import { loggingMiddleware } from './middleware/logging.middleware';

const app = new YasuiApp({
  port: 3000,
  debug: true,
  cors: true,
  middleware: [loggingMiddleware] // Ajouter le middleware global
});

app.registerControllers([UserController]);

app.start().then(() => {
  console.log('üöÄ L\'API YasuiJS fonctionne sur http://localhost:3000');
  console.log('üìö Documentation API disponible sur http://localhost:3000/api-docs');
});
```

## Structure du projet

Votre structure de projet finale devrait ressembler √† ceci :

```
mon-api-yasui/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.controller.ts
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logging.middleware.ts
‚îÇ   ‚îî‚îÄ‚îÄ app.ts
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îî‚îÄ‚îÄ README.md
```

## Ce que vous avez appris

F√©licitations ! Vous avez cr√©√© avec succ√®s une API YasuiJS compl√®te avec :

- **Contr√¥leurs** : G√®rent les requ√™tes HTTP et les r√©ponses
- **Services** : Contiennent la logique m√©tier avec injection de d√©pendances
- **Middleware** : Traitent les requ√™tes globalement
- **Extraction de param√®tres** : Extraction automatique des param√®tres de requ√™te, du corps, etc.
- **Gestion d'erreurs** : Gestion d'erreurs de base avec try-catch
- **TypeScript** : S√©curit√© de type compl√®te dans toute l'application

## Prochaines √©tapes

Maintenant que vous avez une API fonctionnelle, vous pouvez explorer des fonctionnalit√©s plus avanc√©es :

1. **Ajouter l'authentification** : Apprendre les middlewares et l'authentification dans le [Guide des middlewares](/fr/reference/middleware)
2. **G√©n√©rer la documentation** : Ajouter des d√©corateurs Swagger pour la documentation automatique d'API
3. **Int√©gration de base de donn√©es** : Connecter √† une vraie base de donn√©es en utilisant des services
4. **Validation** : Ajouter la validation de requ√™tes et la gestion d'erreurs
5. **Tests** : √âcrire des tests unitaires et d'int√©gration pour votre API

## D√©pannage

### Probl√®mes courants

**Port d√©j√† utilis√©** : Si vous obtenez une erreur concernant le port 3000 occup√©, changez le port dans votre configuration :
```typescript
const app = new YasuiApp({
  port: 3001  // Utiliser un port diff√©rent
});
```

**Erreurs TypeScript** : Assurez-vous que votre `tsconfig.json` a les bons param√®tres de d√©corateurs :
```json
{
  "compilerOptions": {
    "experimentalDecorators": true,
    "emitDecoratorMetadata": true
  }
}
```

**R√©solution de modules** : Si vous obtenez des erreurs d'import, assurez-vous que vos chemins de fichiers sont corrects et que TypeScript est correctement configur√©.

## Besoin d'aide ?

Si vous rencontrez des probl√®mes ou avez des questions :

1. Consultez le guide [Concepts de base](/fr/guide/basic-concepts) pour des explications d√©taill√©es
2. Consultez la [R√©f√©rence des d√©corateurs](/fr/reference/decorators) pour tous les d√©corateurs disponibles
3. Regardez les [Exemples dans le code source](https://github.com/thomasbarkats/yasui/tree/main/src/examples) pour des cas d'usage plus complexes

Bon codage avec YasuiJS ! 